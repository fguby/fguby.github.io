<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="(๑•̀ㅂ•́)و✧" href="https://fguby.love/rss.xml"><link rel="alternate" type="application/atom+xml" title="(๑•̀ㅂ•́)و✧" href="https://fguby.love/atom.xml"><link rel="alternate" type="application/json" title="(๑•̀ㅂ•́)و✧" href="https://fguby.love/feed.json"><script src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11"></script><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="hotpatch"><link rel="canonical" href="https://fguby.love/hotpatch-2/"><title>热补丁之旅（二）ELF研究 - ELF - C | Midoriya = (๑•̀ㅂ•́)و✧ = 人间情事一丢，就有了清澈的骨骼</title><meta name="generator" content="Hexo 5.3.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">热补丁之旅（二）ELF研究</h1><div class="meta"><span class="item" title="创建时间：2021-01-24 11:29:25"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2021-01-24T11:29:25+08:00">2021-01-24</time> </span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">本文字数</span> <span>7.6k</span> <span class="text">字</span> </span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">阅读时长</span> <span>7 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">Midoriya</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://tva4.sinaimg.cn/large/6833939bly1giclh5u05ej20zk0m87df.jpg"></li><li class="item" data-background-image="https://tva4.sinaimg.cn/large/6833939bly1giph4lm9i7j20zk0m84qp.jpg"></li><li class="item" data-background-image="https://tva4.sinaimg.cn/large/6833939bly1giclgrvbd6j20zk0m8qv5.jpg"></li><li class="item" data-background-image="https://tva4.sinaimg.cn/large/6833939bly1gipewf5l51j20zk0m8b29.jpg"></li><li class="item" data-background-image="https://tva4.sinaimg.cn/large/6833939bly1gipeubcbajj20zk0m8h1h.jpg"></li><li class="item" data-background-image="https://tva4.sinaimg.cn/large/6833939bly1giclx6phq6j20zk0m8e36.jpg"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span><i class="ic i-angle-right"></i> <span itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/C/" itemprop="item" rel="index" title="分类于 C"><span itemprop="name">C</span></a><meta itemprop="position" content="1"></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/C/ELF/" itemprop="item" rel="index" title="分类于 ELF"><span itemprop="name">ELF</span></a><meta itemprop="position" content="2"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://fguby.love/hotpatch-2/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="我妻善逸"><meta itemprop="description" content="人间情事一丢，就有了清澈的骨骼, 懒、宅、二次元、萝莉控"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="(๑•̀ㅂ•́)و✧"></span><div class="body md" itemprop="articleBody"><p>要想反编译一个 Linux 二进制文件或者实现热补丁的原理，那么不可避免地，首先就需要理解二进制格式本身。</p><p><a id="more"></a></p><p>一个 ELF 文件由 4 部分组成</p><ol><li>ELF 头 （ELF header）</li><li>程序头表 （Program header table）</li><li>节 （Section）</li><li>节头表 （Section header table）</li></ol><h2 id="文件类型"><a class="anchor" href="#文件类型">#</a> 文件类型</h2><p>一个 ELF 文件可以分为以下几种类型 （由 e_type 的值决定）</p><ol><li><p>ET_NOTE</p><p>未知类型，表明文件类型不确定，或者还未定义</p></li><li><p>ET_REL</p><p>重定位文件，意味着这个文件里标记了一段可重定位的代码，也就是编译后的.o 文件</p></li><li><p>ET_EXEC</p><p>可执行文件，就是通常所说的二进制文件。</p></li><li><p>ET_DYN</p><p>共享目标文件，一个动态的可链接的目标文件，也称为共享库，也就是 so 文件</p></li><li><p>ET_CORE</p><p>核心文件，在程序崩溃或者进程传递了一个 SIGSEGV 信号时，会在核心文件中记录整个进程的镜像信息</p></li></ol><h2 id="elf-header"><a class="anchor" href="#elf-header">#</a> ELF header</h2><p>程序头是对二进制文件中段的描述，是程序装载所必需的一部分。段是在内核装载时被解析的，描述了磁盘上可执行文件的内存布局以及如何映射到内存中。</p><p>64 位可执行文件程序头结构如下：（每个字段的详细值都可以从该节末的链接中查看）</p><figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">typedef</span> <span class="token keyword">struct</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token keyword">unsigned</span> <span class="token keyword">char</span> e_ident<span class="token punctuation">[</span>EI_NIDENT<span class="token punctuation">]</span><span class="token punctuation">;</span>   </pre></td></tr><tr><td data-num="4"></td><td><pre>  Elf64_Half    e_type<span class="token punctuation">;</span>        	<span class="token comment">/* 文件类型 */</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  Elf64_Half    e_machine<span class="token punctuation">;</span>       <span class="token comment">/* 编译平台 */</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  Elf64_Word    e_version<span class="token punctuation">;</span>       <span class="token comment">/* 版本 */</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  Elf64_Addr    e_entry<span class="token punctuation">;</span>       	<span class="token comment">/* 入口函数的虚拟地址 */</span></pre></td></tr><tr><td data-num="8"></td><td><pre>  Elf64_Off 	e_phoff<span class="token punctuation">;</span>      		<span class="token comment">/* 程序头表的偏移量 */</span></pre></td></tr><tr><td data-num="9"></td><td><pre>  Elf64_Off 	e_shoff<span class="token punctuation">;</span>       	<span class="token comment">/* 节头表的偏移量 */</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  Elf64_Word    e_flags<span class="token punctuation">;</span>       	<span class="token comment">/* Processor-specific flags */</span></pre></td></tr><tr><td data-num="11"></td><td><pre>  Elf64_Half    e_ehsize<span class="token punctuation">;</span>      	<span class="token comment">/* ELF header size in bytes */</span></pre></td></tr><tr><td data-num="12"></td><td><pre>  Elf64_Half    e_phentsize<span class="token punctuation">;</span>     <span class="token comment">/* 程序头表的大小 */</span></pre></td></tr><tr><td data-num="13"></td><td><pre>  Elf64_Half    e_phnum<span class="token punctuation">;</span>        	<span class="token comment">/* 程序头表的数量 */</span></pre></td></tr><tr><td data-num="14"></td><td><pre>  Elf64_Half    e_shentsize<span class="token punctuation">;</span>     <span class="token comment">/* 节头表的大小 */</span></pre></td></tr><tr><td data-num="15"></td><td><pre>  Elf64_Half    e_shnum<span class="token punctuation">;</span>        	<span class="token comment">/* 节头表的数目 */</span></pre></td></tr><tr><td data-num="16"></td><td><pre>  Elf64_Half    e_shstrndx<span class="token punctuation">;</span>     	<span class="token comment">/* Section header string table index */</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token punctuation">&#125;</span> Elf64_Ehdr<span class="token punctuation">;</span></pre></td></tr></table></figure><p>第一个字段 <code>e_ident</code> 是一个 16 字节的数组，用于标识文件。 <code>e_ident</code> 的前 4 个字节（即文件本身的前 4 个字节）是序列（0x7f, 'E', 'L', 'F')，用来将文件标记为 ELF 文件</p><p><code>e_type</code> 目标文件类型，主要值：</p><table><thead><tr><th>Name</th><th>Value</th><th>Meaning</th></tr></thead><tbody><tr><td>ET_NOTE</td><td>0</td><td>未知类型</td></tr><tr><td>ET_REL</td><td>1</td><td>可重定位文件</td></tr><tr><td>ET_EXEC</td><td>2</td><td>可执行的二进制文件</td></tr><tr><td>ET_DYN</td><td>3</td><td>动态库 so 文件</td></tr><tr><td>ET_CORE</td><td>4</td><td>core 文件</td></tr></tbody></table><p><code>e_machine</code> 标明了该二进制文件的编译平台，例如 <code>0x3e</code> 代表 AMD x86-64 的架构</p><p>可以从文末的链接中查看每个字段的详细信息。</p><h3 id="重要属性"><a class="anchor" href="#重要属性">#</a> 重要属性</h3><p>有几个比较重要的属性需要提前注意一下，后面写代码时会用到：</p><ol><li><p>e_phoff</p><p>segment 的头部偏移</p></li><li><p>e_phentsize</p><p>segment 的头部大小</p></li><li><p>e_phnum</p><p>segment 的头部数量</p></li><li><p>e_shoff</p><p>section 的头部偏移</p></li><li><p>e_shentsize</p><p>section 的头部大小</p></li><li><p>e_shnum</p><p>section 的头部数量</p></li></ol><h3 id="关于e_shstrndx"><a class="anchor" href="#关于e_shstrndx">#</a> 关于 <code>e_shstrndx</code></h3><p>ELF 文件中的每个 section 都是有名字的，比如.data、.text，每个名字其实都是一个字符串，既然是字符串就需要一个字符串池来保存，而这个字符串池其实也是一个 section。这个特殊的字符串池叫.shstrtab。</p><p>前面的示例图中其实也能够看到，所有 section 的头部都是连续存放在一起的，类似于一个数组，而这个 e_shsrtndx 变量就是.shstrtab 这个节在这个数组中的下标。</p><h2 id="program-headers"><a class="anchor" href="#program-headers">#</a> Program headers</h2><p>程序头是对二进制文件中段的描述，是程序装载必需的一部分。段（segment）是在内核装载时被解析的，描述了磁盘上可执行文件的内存布局以及如何映射到内存中，可以通过引用原始 ELF 头中 <code>e_phoff</code> 的偏移量来得到程序头表。</p><figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">elf64_phdr</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    Elf64_Word p_type<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    Elf64_Word p_flags<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    Elf64_Off p_offset<span class="token punctuation">;</span> <span class="token comment">/* Segment file offset */</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    Elf64_Addr p_vaddr<span class="token punctuation">;</span> <span class="token comment">/* Segment virtual address */</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    Elf64_Addr p_paddr<span class="token punctuation">;</span> <span class="token comment">/* Segment physical address */</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    Elf64_Xword p_filesz<span class="token punctuation">;</span>   <span class="token comment">/* Segment size in file */</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    Elf64_Xword p_memsz<span class="token punctuation">;</span>    <span class="token comment">/* Segment size in memory */</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    Elf64_Xword p_align<span class="token punctuation">;</span>    <span class="token comment">/* Segment alignment, file &amp; memory */</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token punctuation">&#125;</span> Elf64_Phdr<span class="token punctuation">;</span></pre></td></tr></table></figure><p>根据 <code>p_type</code> 的值，可以判断段的类型，从 <code>elf.h</code> 头文件中可以看到段的类型比较多</p><pre><code class="language-c#">#define	PT_NULL		0		/* Program header table entry unused */
#define PT_LOAD		1		/* Loadable program segment */
#define PT_DYNAMIC	2		/* Dynamic linking information */
#define PT_INTERP	3		/* Program interpreter */
#define PT_NOTE		4		/* Auxiliary information */
#define PT_SHLIB	5		/* Reserved */
#define PT_PHDR		6		/* Entry for header table itself */
#define PT_TLS		7		/* Thread-local storage segment */
#define	PT_NUM		8		/* Number of defined types */
#define PT_LOOS		0x60000000	/* Start of OS-specific */
#define PT_GNU_EH_FRAME	0x6474e550	/* GCC .eh_frame_hdr segment */
#define PT_GNU_STACK	0x6474e551	/* Indicates stack executability */
#define PT_GNU_RELRO	0x6474e552	/* Read-only after relocation */
#define PT_LOSUNW	0x6ffffffa
#define PT_SUNWBSS	0x6ffffffa	/* Sun Specific segment */
#define PT_SUNWSTACK	0x6ffffffb	/* Stack segment */
#define PT_HISUNW	0x6fffffff
#define PT_HIOS		0x6fffffff	/* End of OS-specific */
#define PT_LOPROC	0x70000000	/* Start of processor-specific */
#define PT_HIPROC	0x7fffffff	/* End of processor-specific */
</code></pre><p>这里介绍一些比较重要的段。</p><h3 id="pt_load"><a class="anchor" href="#pt_load">#</a> PT_LOAD</h3><p>一个 ELF 文件至少有一个 PT_LOAD 类型的段，这类程序头描述的是可装载的段，也就是说，这种类型的段将被装载或者映射到内存中。</p><p>例如，一个需要动态链接的 ELF 可执行文件通常会包含以下两个可以装载的段（类型为 PT_LOAD)</p><ol><li>存放程序代码的 text 段</li><li>存放全局变量和动态链接信息的 data 段</li></ol><p>text 段也就是经常说的代码段，该段的权限一般设置为 PT_X | PT_R ，0x05</p><p>data 段也就是数据段，权限一般设置为 PT_W | PT_R （读和写）0x06</p><p>这里要注意的是，text 段和 data 段都是 <code>PT_LOAD</code> 类型的段，判断段究竟是 <code>text</code> 段还是 <code>data</code> 段还需要取 <code>p_offset</code> 的值。</p><p><code>p_offset</code> 等于 0 的 <code>PT_LOAD</code> 类型的段才是 text 段。</p><h3 id="pt_dynamic"><a class="anchor" href="#pt_dynamic">#</a> PT_DYNAMIC</h3><p>动态段是动态链接可执行文件所特有的，包含了动态链接器所必需的一些信息。</p><ol><li>运行时需要链接的共享库列表</li><li>全局偏移表（GOT）的地址</li><li>重定位的相关信息</li></ol><h3 id="pt_note"><a class="anchor" href="#pt_note">#</a> PT_NOTE</h3><p>该类型的段可能保存了与系统相关的附加信息，在可执行文件实际运行时是不需要这个段的。</p><h3 id="pt_interp"><a class="anchor" href="#pt_interp">#</a> PT_INTERP</h3><p>该段只将位置和大小信息存放在一个以 null 为终止符的字符串中，是对程序解释器位置的描述。</p><p>例如， <code>/lib/ld-linx.so.2</code> 一般是指动态链接器的位置，也即程序解释器的位置。</p><h3 id="pt_phdr"><a class="anchor" href="#pt_phdr">#</a> PT_PHDR</h3><p>该段保存了程序头表的本身的位置和大小，保存了所有的 Phdr 对文件中段的描述信息。</p><h2 id="section-header"><a class="anchor" href="#section-header">#</a> Section header</h2><p>在每个段中，会有代码和数据被划分为不同的节。节头表是对这些节的位置和大小的描述，主要用于链接和调试。</p><h3 id="text节"><a class="anchor" href="#text节">#</a> .text 节</h3><p>存放编译好的二进制可执行代码，如果存在 Phdr，.text 节就会存在于.text 段中，由于.text 节保存了程序代码，因此节的类型为 <code>SHT_PROGBITS</code></p><h3 id="rodata节"><a class="anchor" href="#rodata节">#</a> .rodata 节</h3><p>保存只读的数据，例如字符串常量、const 的变量，只能在 text 段中找到.rodata 节</p><h3 id="plt节"><a class="anchor" href="#plt节">#</a> .plt 节</h3><p>包含了动态链接器调用从共享库导入的函数所必需的相关代码</p><h3 id="data节"><a class="anchor" href="#data节">#</a> .data 节</h3><p>.data 节存在于 data 段中，保存了初始化的全局变量等数据</p><h3 id="bss节"><a class="anchor" href="#bss节">#</a> .bss 节</h3><p>保存了未进行初始化的全局变量，是 data 段的一部分，占用空间不超过 4 字节，仅表示这个节本身的空间。</p><h3 id="symtab"><a class="anchor" href="#symtab">#</a> .symtab</h3><p>符号表，记录的则是函数和变量</p><h3 id="strtab"><a class="anchor" href="#strtab">#</a> .strtab</h3><p>字符串表、字符串常量和变量名</p><h3 id="gotplt节"><a class="anchor" href="#gotplt节">#</a> .got.plt 节</h3><p>.got 节保存了全局偏移表，.got 节和.plt 节一起提供了对导入的共享库函数的访问入口，由动态链接器在运行时进行修改。</p><h3 id="dynsym节"><a class="anchor" href="#dynsym节">#</a> .dynsym 节</h3><p>保存了从共享库导入的动态符号信息，该节保存在 text 段中，节类型被标记为 SHT_DYNSYM</p><p>一个 <code>text</code> 段的布局如下：</p><ul><li>[.text] 程序代码</li><li>[.rodata] 只读数据</li><li>[.hash] 符号散列表</li><li>[.dynsym] 共享目标文件符号数据</li><li>[.dynstr] 共享目录文件符号名称</li><li>[.plt] 过程链接表</li><li>[.rel.got] G.O.T 重定位数据</li></ul><h2 id="elf符号"><a class="anchor" href="#elf符号">#</a> ELF 符号</h2><p>符号是对某些类型的数据或者代码（如全局变量和函数）的符号引用。</p><p>例如，printf () 函数会在动态符号表.dynsym 中存有一个指向该函数的符号条目。</p><p>在大多数共享库和动态链接可执行文件中，存在两个符号表： <code>.dynsym</code> 和 <code>.symtab</code> 。</p><p>.dynsym 保存了引用来自外部文件符号的全局符号，如 printf 这样的库函数，.dynsym 保存的符号是.symtab 所保存符号的子集，.symtab 中还保存了可执行文件的本地符号，如全局变量或者代码中定义的本地函数。</p><p>因此，.symtab 保存了所有的符号，而.dynsym 只保存动态 / 全局符号。</p><p>使用 <code>readelf -S main</code> 查看二进制文件的节头，这里我删去一些暂时无用的节</p><pre><code>[Nr] Name              Type             Address           Offset
       Size              EntSize          Flags  Link  Info  Align

  [ 5] .dynsym           DYNSYM           00000000000002b8  000002b8
       00000000000000f0  0000000000000018   A       6     1     8

  [26] .symtab           SYMTAB           0000000000000000  00001040
       0000000000000660  0000000000000018          27    43     8


</code></pre><p>从打印出来的信息中可以看到一部分节的 Flags 被标记为了 A（ALLOC）、WA（WRITE/ALLOC）或者 AX（ALLOC/EXC）</p><p>.dynsym 被标记了 A（ALLOC），而.symtab 则没有被标记</p><p><code>ALLOC</code> 表示有该标记的节会在运行时分配并装载进入内存，而.symtab 不是在运行时必需的，因此不会被装载到内存中。.dynsym 保存的符号只能在运行时被解析，因此是运行时动态链接器所需要的唯一符号。</p><p><code>.dynsym</code> 符号表对于动态链接可执行文件的执行来说是必需的</p><p>一个 64 位 ELF 文件符号项的结构</p><figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    uint32_t      st_name<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">unsigned</span> <span class="token keyword">char</span> st_info<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">unsigned</span> <span class="token keyword">char</span> st_other<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    uint16_t      st_shndx<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    Elf64_Addr    st_value<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    Uint64_t      st_size<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">&#125;</span> Elf64_sym<span class="token punctuation">;</span></pre></td></tr></table></figure><ol><li><p>st_name</p><p>保存了指向符号表中字符串表（位于.dynstr 或者.strtab）的偏移地址，偏移地址存放着符号的名称，如 printf</p></li><li><p>st_value</p><p>存放符号的值（可能是地址或者位置偏移量）</p></li><li><p>st_size</p><p>存放了一个符号的大小</p></li><li><p>st_shndx</p><p>每个符号表条目的定义都与某些节对应，该变量保存了相关节头表的索引</p></li><li><p>st_info</p><p>符号类型</p></li></ol><h3 id="查看符号表条目"><a class="anchor" href="#查看符号表条目">#</a> 查看符号表条目</h3><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>readelf -s 二进制文件 <span class="token comment"># 注意是小写的 s</span></pre></td></tr></table></figure><h2 id="修改elf文件的入口"><a class="anchor" href="#修改elf文件的入口">#</a> 修改 ELF 文件的入口</h2><p>好了，去掉那些长篇大论的废话，学习还是要从实践开始入手。</p><p>如果你对结构还有不清楚的地方，可以自行去谷歌学习一下，在这里我引用一张别的博客所画的结构图，文末有博客链接。</p><p><img data-src="/images/elf-file-format.png" alt="avatar"></p><p>先从一个简单的功能开始，修改一个 ELF 文件的入口地址。</p><p>一段示例代码</p><figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">int</span> stage <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">__attribute__</span><span class="token punctuation">(</span><span class="token punctuation">(</span>constructor<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">void</span> <span class="token function">initializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    stage <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"initializer function (stage: %d) \n"</span><span class="token punctuation">,</span> stage<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token keyword">__attribute__</span><span class="token punctuation">(</span><span class="token punctuation">(</span>destructor<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token keyword">void</span> <span class="token function">finalizer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    stage <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"finalizer function (stage: %d) \n"</span><span class="token punctuation">,</span> stage<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="17"></td><td><pre></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    stage <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"main function (stage: %d) \n"</span><span class="token punctuation">,</span> stage<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="23"></td><td><pre></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token keyword">void</span> <span class="token function">alternativeEntryPoint</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    stage <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"This is an alternative entry point to the program (stage: %d) \n"</span><span class="token punctuation">,</span> stage<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>    <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>正常编译后的打印应该如下：</p><blockquote><p>initializer function (stage: 1)<br>main function (stage: 2)<br>finalizer function (stage: 3)</p></blockquote><p>首先，找一下 <code>alternativeEntryPoint</code> 函数的地址</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>readelf -s <span class="token builtin class-name">test</span> <span class="token operator">|</span> <span class="token function">grep</span> alternativeEntryPoint</pre></td></tr></table></figure><p>得到</p><pre><code> 54: 000000000000074b    54 FUNC    GLOBAL DEFAULT   14 alternativeEntryPoint
</code></pre><p>ok，可以看到 <code>alternativeEntryPoint</code> 函数的入口地址是 <code>0x74b</code></p><p>然后，修改代码如下</p><figure class="highlight c"><figcaption data-lang="c"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;fcntl.h></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/stat.h></span></span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/mman.h></span></span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h></span></span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;elf.h></span></span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token keyword">int</span> fd<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token keyword">struct</span> <span class="token class-name">stat</span> st<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    Elf64_Ehdr <span class="token operator">*</span>ehdr<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre>    fd <span class="token operator">=</span> <span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"test"</span><span class="token punctuation">,</span> O_RDWR<span class="token operator">|</span>O_CREAT<span class="token punctuation">,</span> <span class="token number">00777</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>fd <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"open fail"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="20"></td><td><pre></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">fstat</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span> <span class="token operator">&amp;</span>st<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"fstat fail"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       </pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="25"></td><td><pre></pre></td></tr><tr><td data-num="26"></td><td><pre>    <span class="token comment">// 建立内存映射</span></pre></td></tr><tr><td data-num="27"></td><td><pre>    <span class="token keyword">char</span> <span class="token operator">*</span>mem <span class="token operator">=</span> <span class="token function">mmap</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> st<span class="token punctuation">.</span>st_size<span class="token punctuation">,</span> PROT_READ<span class="token operator">|</span>PROT_WRITE<span class="token punctuation">,</span> MAP_SHARED<span class="token punctuation">,</span> fd<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>mem <span class="token operator">==</span> MAP_FAILED<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"mmap failed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="31"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="32"></td><td><pre></pre></td></tr><tr><td data-num="33"></td><td><pre>    ehdr <span class="token operator">=</span> <span class="token punctuation">(</span>Elf64_Ehdr <span class="token operator">*</span><span class="token punctuation">)</span>mem<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="34"></td><td><pre>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"old entry: %lx"</span><span class="token punctuation">,</span> ehdr<span class="token operator">-></span>e_entry<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="35"></td><td><pre>    </pre></td></tr><tr><td data-num="36"></td><td><pre>    <span class="token comment">// 在这里将入口修改为 0x74b</span></pre></td></tr><tr><td data-num="37"></td><td><pre>    ehdr<span class="token operator">-></span>e_entry <span class="token operator">=</span> <span class="token number">0x74b</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="38"></td><td><pre>    <span class="token function">close</span><span class="token punctuation">(</span>fd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="39"></td><td><pre>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="40"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>编译修改代码 =&gt; 执行，应该会打印出原本 ELF 文件的入口地址。</p><p>这时候，再用 <code>readelf</code> 命令查看一下二进制文件：</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>readelf -h <span class="token builtin class-name">test</span></pre></td></tr></table></figure><pre><code>ELF Header:
  Magic:   7f 45 4c 46 02 01 01 00 00 00 00 00 00 00 00 00 
  Class:                             ELF64
  Data:                              2's complement, little endian
  Version:                           1 (current)
  OS/ABI:                            UNIX - System V
  ABI Version:                       0
  Type:                              DYN (Shared object file)
  Machine:                           Advanced Micro Devices X86-64
  Version:                           0x1
  Entry point address:               0x74b
  Start of program headers:          64 (bytes into file)
  Start of section headers:          6632 (bytes into file)
  Flags:                             0x0
  Size of this header:               64 (bytes)
  Size of program headers:           56 (bytes)
  Number of program headers:         9
  Size of section headers:           64 (bytes)
  Number of section headers:         29
  Section header string table index: 28

</code></pre><p>入口地址顺利修改成功，再次执行二进制文件，输出：</p><pre><code>This is an alternative entry point to the program (stage: 1)
</code></pre><h2 id="参考"><a class="anchor" href="#参考">#</a> 参考</h2><p><span class="exturl" data-url="aHR0cDovL2NodXF1YW4ubWUvMjAxOC8wNS8yMS9lbGYtaW50cm9kdWNlLw==">http://chuquan.me/2018/05/21/elf-introduce/</span></p><p><span class="exturl" data-url="aHR0cHM6Ly9yZWZzcGVjcy5saW51eGZvdW5kYXRpb24ub3JnL2VsZi9nYWJpNCsvY2g0LmVoZWFkZXIuaHRtbA==">https://refspecs.linuxfoundation.org/elf/gabi4+/ch4.eheader.html</span></p><p><span class="exturl" data-url="aHR0cHM6Ly9wYXBlci5zZWVidWcub3JnLzg5Lw==">https://paper.seebug.org/89/</span></p><div class="tags"><a href="/tags/hotpatch/" rel="tag"><i class="ic i-tag"></i> hotpatch</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">更新于</span> <time title="修改时间：2021-01-24 11:38:57" itemprop="dateModified" datetime="2021-01-24T11:38:57+08:00">2021-01-24</time> </span><span id="hotpatch-2/" class="item leancloud_visitors" data-flag-title="热补丁之旅（二）ELF研究" title="阅读次数"><span class="icon"><i class="ic i-eye"></i> </span><span class="text">阅读次数</span> <span class="leancloud-visitors-count"></span> <span class="text">次</span></span></div><div class="reward"><button><i class="ic i-heartbeat"></i> 赞赏</button><p>请我喝[茶]~(￣▽￣)~*</p><div id="qr"><div><img data-src="/images/wechatpay.png" alt="我妻善逸 微信支付"><p>微信支付</p></div><div><img data-src="/images/alipay.png" alt="我妻善逸 支付宝"><p>支付宝</p></div><div><img data-src="/images/paypal.png" alt="我妻善逸 贝宝"><p>贝宝</p></div></div></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>我妻善逸 <i class="ic i-at"><em>@</em></i>(๑•̀ㅂ•́)و✧</li><li class="link"><strong>本文链接：</strong> <a href="https://fguby.love/hotpatch-2/" title="热补丁之旅（二）ELF研究">https://fguby.love/hotpatch-2/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/hotpatch-1/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;tva4.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1gipewkhf1zj20zk0m81kx.jpg" title="热补丁之旅（一）开胃小菜"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i> C</span><h3>热补丁之旅（一）开胃小菜</h3></a></div><div class="item right"></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.</span> <span class="toc-text">文件类型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#elf-header"><span class="toc-number">2.</span> <span class="toc-text">ELF header</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%87%8D%E8%A6%81%E5%B1%9E%E6%80%A7"><span class="toc-number">2.1.</span> <span class="toc-text">重要属性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E4%BA%8Ee_shstrndx"><span class="toc-number">2.2.</span> <span class="toc-text">关于 e_shstrndx</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#program-headers"><span class="toc-number">3.</span> <span class="toc-text">Program headers</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#pt_load"><span class="toc-number">3.1.</span> <span class="toc-text">PT_LOAD</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#pt_dynamic"><span class="toc-number">3.2.</span> <span class="toc-text">PT_DYNAMIC</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#pt_note"><span class="toc-number">3.3.</span> <span class="toc-text">PT_NOTE</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#pt_interp"><span class="toc-number">3.4.</span> <span class="toc-text">PT_INTERP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#pt_phdr"><span class="toc-number">3.5.</span> <span class="toc-text">PT_PHDR</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#section-header"><span class="toc-number">4.</span> <span class="toc-text">Section header</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#text%E8%8A%82"><span class="toc-number">4.1.</span> <span class="toc-text">.text 节</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#rodata%E8%8A%82"><span class="toc-number">4.2.</span> <span class="toc-text">.rodata 节</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#plt%E8%8A%82"><span class="toc-number">4.3.</span> <span class="toc-text">.plt 节</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#data%E8%8A%82"><span class="toc-number">4.4.</span> <span class="toc-text">.data 节</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#bss%E8%8A%82"><span class="toc-number">4.5.</span> <span class="toc-text">.bss 节</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#symtab"><span class="toc-number">4.6.</span> <span class="toc-text">.symtab</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#strtab"><span class="toc-number">4.7.</span> <span class="toc-text">.strtab</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#gotplt%E8%8A%82"><span class="toc-number">4.8.</span> <span class="toc-text">.got.plt 节</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#dynsym%E8%8A%82"><span class="toc-number">4.9.</span> <span class="toc-text">.dynsym 节</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#elf%E7%AC%A6%E5%8F%B7"><span class="toc-number">5.</span> <span class="toc-text">ELF 符号</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E7%AC%A6%E5%8F%B7%E8%A1%A8%E6%9D%A1%E7%9B%AE"><span class="toc-number">5.1.</span> <span class="toc-text">查看符号表条目</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9elf%E6%96%87%E4%BB%B6%E7%9A%84%E5%85%A5%E5%8F%A3"><span class="toc-number">6.</span> <span class="toc-text">修改 ELF 文件的入口</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83"><span class="toc-number">7.</span> <span class="toc-text">参考</span></a></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li class="active"><a href="/hotpatch-2/" rel="bookmark" title="热补丁之旅（二）ELF研究">热补丁之旅（二）ELF研究</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="我妻善逸" data-src="/images/avatar.jpg"><p class="name" itemprop="name">我妻善逸</p><div class="description" itemprop="description">懒、宅、二次元、萝莉控</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">6</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">5</span> <span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">4</span> <span class="name">标签</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL2ZndWJ5" title="https:&#x2F;&#x2F;github.com&#x2F;fguby"><i class="ic i-github"></i></span> <span class="exturl item zhihu" data-url="aHR0cHM6Ly93d3cuemhpaHUuY29tL3Blb3BsZS9mZ3VieQ==" title="https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;fguby"><i class="ic i-zhihu"></i></span> <span class="exturl item music" data-url="aHR0cHM6Ly9tdXNpYy4xNjMuY29tLyMvdXNlci9ob21lP2lkPTM1MTcyNzQ3Mw==" title="https:&#x2F;&#x2F;music.163.com&#x2F;#&#x2F;user&#x2F;home?id&#x3D;351727473"><i class="ic i-cloud-music"></i></span> <span class="exturl item about" data-url="aHR0cHM6Ly9hYm91dC5tZS9mZ3VieQ==" title="https:&#x2F;&#x2F;about.me&#x2F;fguby"><i class="ic i-address-card"></i></span> <span class="exturl item email" data-url="bWFpbHRvOmZndWJ5MTk5NUBnbWFpbC5jb20=" title="mailto:fguby1995@gmail.com"><i class="ic i-envelope"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li></ul></div></div></div><ul id="quick"><li class="prev pjax"></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/Golang/" title="分类于 Golang">Golang</a></div><span><a href="/Golang/" title="Go Scheduler">Go Scheduler</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/TypeScript/" title="分类于 TypeScript">TypeScript</a></div><span><a href="/typescript/" title="TypeScript学习手册">TypeScript学习手册</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Golang/" title="分类于 Golang">Golang</a></div><span><a href="/go-gc/" title="Go GC">Go GC</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/C/" title="分类于 C">C</a> <i class="ic i-angle-right"></i> <a href="/categories/C/ELF/" title="分类于 ELF">ELF</a></div><span><a href="/hotpatch-2/" title="热补丁之旅（二）ELF研究">热补丁之旅（二）ELF研究</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/C/" title="分类于 C">C</a></div><span><a href="/hotpatch-1/" title="热补丁之旅（一）开胃小菜">热补丁之旅（一）开胃小菜</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E5%B7%A5%E5%85%B7/" title="分类于 工具">工具</a></div><span><a href="/beautify-blog/" title="美化系列小记：Hexo博客">美化系列小记：Hexo博客</a></span></li></ul></div><div><h2>最新评论</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2010 – <span itemprop="copyrightYear">2021</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">我妻善逸 @ Midoriya</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="站点总字数">26k 字</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="站点阅读时长">24 分钟</span></div><div class="powered-by">基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"hotpatch-2/",favicon:{show:"（●´3｀●）やれやれだぜ",hide:"(´Д｀)大変だ！"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({pluginRootPath:"live2dw/",pluginJsPath:"lib/",pluginModelPath:"assets/",tagMode:!1,debug:!1,model:{scale:1.1,hHeadPos:.5,vHeadPos:.618,jsonPath:"/live2dw/assets/xiaomai.model.json"},display:{position:"right",width:200,height:400,vOffset:20},mobile:{show:!0,scale:.8},react:{opacityDefault:.7,opacityOnHover:.2},log:!1})</script></body></html>